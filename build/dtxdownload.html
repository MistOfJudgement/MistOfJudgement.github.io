<!DOCTYPE html>
<html lang="en">
	
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>DTX Downloader</title>
		<script>
			// Cookie helper functions
			function setCookie(name, value, days = 365) {
			const expires = new Date(Date.now() + days * 864e5).toUTCString();
			document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/';
			}
			
			function getCookie(name) {
			return document.cookie.split('; ').reduce((r, v) => {
			const parts = v.split('=');
			return parts[0] === name ? decodeURIComponent(parts[1]) : r;
			}, '');
			}
			
			// Apply saved theme immediately to prevent flicker
			const savedTheme = getCookie('preferred-theme');
			if (savedTheme) {
			if (savedTheme === 'none') {
			// No CSS - we'll disable it after the link loads
			document.write('<link id="main-stylesheet" rel="stylesheet" href="./static/clean.css" disabled />');
			} else {
			document.write('<link id="main-stylesheet" rel="stylesheet" href="' + savedTheme + '" />');
			}
			} else {
			document.write('<link id="main-stylesheet" rel="stylesheet" href="./static/clean.css" />');
			}
		</script>
	</head>
	
	<body>
		<header>
			<h1>DTX Downloader</h1>
		</header>
		<nav>
			<ul>
				<li><a href="index.html">Home</a></li>
				<li><span>Projects</span>
					<ul>
						<li><a href="website.html">Website</a></li>
						<li><a href="analog_frequency_detector.html">Analog Frequency Detector</a></li>
						<li><a href="bad_apple_celeste.html">Bad Apple Celeste</a></li>
						<li><a href="bad_apple_terminal.html">Bad Apple Terminal</a></li>
						<li><a href="web_dev_project.html">Web Dev Project</a></li>
						<li><a href="dtxdownload.html">DTX Downloader</a></li>
					</ul>
				</li>
				<li><a href="about.html">About</a></li>
				<li><a href="contact.html">Contact</a></li>
			</ul>
			<div class="theme-selector">
				<label for="stylesheet-dropdown">Theme:</label>
				<select id="stylesheet-dropdown" onchange="switchStylesheet()">
					<option value="./static/clean.css">Clean (Original)</option>
					<option value="./static/modern.css">Modern Dark</option>
					<option value="">No CSS</option>
				</select>
			</div>
		</nav>
		<main>
			
			<p><a href=https://github.com/MistOfJudgement/dtxdownload>Github Repo</a><p>
					
					<h2>Problem & Purpose</h2>
					<p>I play a couple of rhythm games, one of which is DrumMania, part of the
						Gitadora series. I ended up buying a used drum kit to be able to play the
						game at home using a fan-made clone called <a href="https://github.com/limyz/DTXmaniaNX">DTXMania</a> (I use the NX fork).
						Using a fan made clone means I also get access to fan-made charts. One such
						charter is <a href="https://approvedtx.blogspot.com">ApprovedDTX</a>, who makes
						a lot of chart I like. However, I wanted an easier way to search through
						the charts and download them. This project is a web scraper and downloader
						initially focused on automating the download of ApprovedDTX charts, but I want
						to keep it extensible to other charters in the future such as <a href="https://dtx.furukon.com/">Furukon</a>.</p>
					
					<h2>Technical Details</h2>
					<p>I had two phases for this project. The first phase was my initial, scrappy
						implementation to get the bare minimum working. The second phase was a rewrite
						to incorporate a UI and test out how useful Github Copilot is for a somewhat
					small refactor.</p>
					
					<h3>Phase 1: Initial Implementation</h3>
					<p>I used Node.js with the base http/https libraries to make requests, and
						Cheerio to parse the HTML and extract the chart links. Thanks to blogspot
						being so uniform, I could directly parse for the chart name, details, and
						download link. I could also reach the next page button to automatically
					paginate through the results. All the chart data was saved to a JSON file</p>
					
					<p>I did make a simple UI for phase 1 by creating an html file that opened
						the JSON file and rendered all the charts into a big table. I had a filter
					option which took what I literally wrote and used it in a filter function.</p>
					
					<code>const filter = new Function("song", "return " + document.getElementById("filter").value);</code>
					
					<p>For the most part, this worked fine. I could select the songs I wanted to
						download and click a button to get the chart ids for those songs, which I copied
					into the downloader</p>
					
					<p>For downloading each of the charts I picked out, the script navigated to
						the download link and tried to extract the actual download link from either
						the "download form" action or following some redirects. I then used the
						request library to download the file and the extract-zip library to unzip
					the chart into my songs folder.</p>
					
					<h3>Phase 2: Rewrite with UI</h3>
					<p>For phase 2, I found out I had Github Copilot access from my Student Developer Pack.
						Along with some AI tools I've been trying at work, I wanted to see how copilot
						stacks up. My motivation here was combining the scraper and downloader into one
					application. </p>
					
					<p>As far as I can tell, the functionality is the same as phase 1 with some
						generalizations. It uses Electron to work as a desktop application which is
						necessary for filesystem access. The scraping has a progress bar and the
						charts appear on the UI with infinite scroll. The filtering follows the
						normal filters one would expect and live updates as you update selectors.
					Downloading of course is done with a single click.</p>
					
					<h2>Conclusion</h2>
					
					<p>Overall, I found Copilot to be a good way to write a lot of mid code. It
						would need a lot of clarfication and validation to be useful for writing the
						more interesting features. I did end up using it with very little oversight
						which I can definitely recommend against. While I did want to rewrite from
						scratch, had I a vision of what the architecture should be so it would have
						probably been simpler to start with all my models and pseudocode. Last note
						on copilot is that it always tends to add code rather than replace. This
					meant doing a bit of cleanup after refactors</p>
					
					<p>For the application itself, super useful. I love using it. There are some
						things I do need to fix at time of writing regarding different download sources
						and better filtering but it feels really good to have all these charts a
					couple of clicks away, all in one place.</p>
					
				</main>
				
				<footer>
					<p>This website is still in development. Thanks for stopping by!</p>
					<script>
						function updateIframeTheme(selectedTheme) {
						// Update all iframes on the page to match the main page theme
						const iframes = document.querySelectorAll('iframe');
						iframes.forEach(iframe => {
						try {
						// Check if iframe is loaded and accessible (same origin)
						const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
						const iframeStylesheet = iframeDoc.getElementById('main-stylesheet');
						
						if (iframeStylesheet) {
						if (selectedTheme === 'none') {
						// No CSS option - disable stylesheet
						iframeStylesheet.disabled = true;
						} else {
						// Enable stylesheet and set the href
						iframeStylesheet.disabled = false;
						iframeStylesheet.href = selectedTheme;
						}
						}
						} catch (e) {
						// Iframe might not be loaded yet or cross-origin, ignore
						console.log('Could not access iframe stylesheet:', e.message);
						}
						});
						}
						
						function switchStylesheet() {
						const dropdown = document.getElementById('stylesheet-dropdown');
						const stylesheet = document.getElementById('main-stylesheet');
						const selectedTheme = dropdown.value;
						
						if (selectedTheme === 'none') {
						// No CSS option - disable stylesheet
						stylesheet.disabled = true;
						} else {
						// Enable stylesheet and set the href
						stylesheet.disabled = false;
						stylesheet.href = selectedTheme;
						}
						
						// Update iframes to match
						updateIframeTheme(selectedTheme);
						
						// Save user's preference in cookies
						setCookie('preferred-theme', selectedTheme);
						}
						
						// Set initial dropdown value on page load
						document.addEventListener('DOMContentLoaded', function() {
						const dropdown = document.getElementById('stylesheet-dropdown');
						dropdown.addEventListener('change', switchStylesheet);
						
						// Set dropdown to match the already-applied theme
						const savedTheme = getCookie('preferred-theme');
						if (savedTheme) {
						dropdown.value = savedTheme;
						}
						
						// Update iframes after a short delay to ensure they're loaded
						setTimeout(() => {
						if (savedTheme) {
						updateIframeTheme(savedTheme);
						}
						}, 500);
						});
					</script>
				</footer>
				
			</body>
			
		</html>